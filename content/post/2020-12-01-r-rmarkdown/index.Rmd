---
title: "Countries alcohol consumtion and happiness levels"
author: "Marcell Puski"
date: 2020-05-29T21:13:14-05:00
categories: ["R"]
tags: ["R Markdown", "plot"]
---













# libraries


```{r}
library(tidyverse)
library(readxl)
library(skimr)
library(dplyr)
library(knitr)

```




# loading data

```{r}
world_happiness <- read_csv("data/2015.csv")

alcohol <- read.csv("data/drinks.csv")

```



# joining data

```{r}
# renaming country column to be the same in the two datasets
world_happiness <- 
  world_happiness %>%
  rename(country = 'Country')

# joining the two datasets based on country names
dt <- left_join(world_happiness, alcohol)


# checking joined data
apply(is.na(dt),2,sum)

# creating data set for missing data
missing_dt <- 
  dt %>%
  filter(is.na(beer_servings))


```




in a few cases there is a mismatch between the datasets in the countries names causing more missing data

The following names represent the same country:

United States = USA
Russia = Russian Federation
Congo (Brazzaville) = Congo
Congo (Kinshasa) = DR Congo
Trinidad and Tobago = Trinidad & Tobago
Somaliland region	= Somalia
Bosnia and Herzegovina = Bosnia-Herzegovina
Ivory Coast = Cote d'Ivoire


# correcting country names 

```{r}
# creating coppy for safty
chumpa <- world_happiness 


# list of country names which needs to be replaced

csere <- c("United States", "Trinidad and Tobago", "Russia", "Somaliland region", "Bosnia and Herzegovina", "Congo (Brazzaville)","Congo (Kinshasa)","Ivory Coast")


# list of corrected country names

bere <- c("USA", "Trinidad & Tobago", "Russian Federation", "Somalia", "Bosnia-Herzegovina", "Congo", "DR Congo", "Cote d'Ivoire")


# renaming country names
szerint <- which(chumpa$country %in% csere)

for (i in 1:length(szerint)) {
  chumpa$country[szerint[i]] <-  bere[i]
  
  
}

# re joining data, with corrected names
dt_clear <- left_join(chumpa, alcohol)


# checking 
dim(dt_clear)
apply(is.na(dt_clear),2,sum)


```




# Deleting NA rows

Deleting rows where there is no data about alcohol consumtion 

```{r}
dt_clear <- na.omit(dt_clear)

# checking
dim(dt_clear)

apply(is.na(dt_clear),2,sum)

```





# renaming columns without spaces

```{r}
dt_clear <- 
  dt_clear %>%
  rename(happiness_score = 'Happiness Score',
         happiness_rank = 'Happiness Rank',
         standard_error = 'Standard Error',
         GDP = 'Economy (GDP per Capita)',
         life_expectancy = 'Health (Life Expectancy)',
         corruption = 'Trust (Government Corruption)',
         dystopia_residual = 'Dystopia Residual',
         total_alcohol = 'total_litres_of_pure_alcohol')

```






# creating sub-groups

alcohol:

0-14.4 

less than

```{r}

dt_clear$alcohol_cat <- cut(dt_clear$total_alcohol, c(-1, 0, 5,10,15), labels = c("doesn't drink","drinks less than 5 liters", "drinks 5-10 liters", "drinks 10-15 liters"))

```






# basic kable

```{r}
kable(head(dt_clear), digits = 2, align = "l", caption = "Avarages about talalj ki valamit")

# avarages about happiness and alcohol consumtion

dt_clear %>%
  summarise(
    mn_happiness = mean(happiness_score),
    md_happiness = median(happiness_score),
    sd_happiness = sd(happiness_score),
    max_happiness = max(happiness_score),
    min_happiness = min(happiness_score),
    mn_alcohol = mean(total_alcohol),
    md_alcohol = median(total_alcohol),
    sd_alcohol = sd(total_alcohol),
    max_alcohol = max(total_alcohol),
    min_alcohol = min(total_alcohol)
  )


# creating summary table by Regions
dt_clear %>%
  group_by(Region) %>%
  summarise(
    mn_happiness = mean(happiness_score),
    md_happiness = median(happiness_score),
    sd_happiness = sd(happiness_score),
    max_happiness = max(happiness_score),
    min_happiness = min(happiness_score),
    mn_alcohol = mean(total_alcohol),
    md_alcohol = median(total_alcohol),
    sd_alcohol = sd(total_alcohol),
    max_alcohol = max(total_alcohol),
    min_alcohol = min(total_alcohol)
  ) 

# Ploting summary table

plot_1 <- dt_clear %>%
  group_by(Region) %>%
  summarise(
    mn_happiness = mean(happiness_score),
    sd_happiness = sd(happiness_score),
    max_happiness = max(happiness_score),
    min_happiness = min(happiness_score),
    mn_alcohol = mean(total_alcohol),
    sd_alcohol = sd(total_alcohol),
    max_alcohol = max(total_alcohol),
    min_alcohol = min(total_alcohol)
  )

# Ehhez meg ezt a standard deviation vonalat nezd meg!

plot_1 %>%
  ggplot() +
  geom_bar(aes(x = Region, y = mn_happiness), stat = "identity") +
  geom_errorbar(aes(x = Region, ymin = mn_happiness - sd_happiness, ymax = mn_happiness + sd_happiness)) +
  theme(axis.text.x = element_text(angle = 90))

plot_1 %>%
  ggplot() +
  geom_bar(aes(x = Region, y = mn_alcohol), stat = "identity") +
  geom_errorbar(aes(x = Region, ymin = mn_alcohol - sd_alcohol, ymax = mn_alcohol + sd_alcohol)) +
  theme(axis.text.x = element_text(angle = 90))
  


```






# Does happy countries drink less alcohol?



```{r}

# alcohol / happiness rank + Region

dt_clear %>%
  arrange(happiness_rank) %>%
  ggplot() +
  geom_point(mapping = aes(x = happiness_rank, y = total_alcohol, color = Region))

# ugyanez + smoothal 

dt_clear %>%
  arrange(happiness_rank) %>%
  ggplot(., mapping = aes(x = happiness_rank, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick")



# alcohol /happinass rank + Region
dt_clear %>%
  arrange(happiness_rank) %>%
  ggplot() +
  geom_point(mapping = aes(x = happiness_rank, y = total_alcohol, color = Region)) +
  facet_wrap(~Region)



```


ugyanaz a kerdes meg


```{r}
dt_clear %>%
  arrange(happiness_rank) %>%
  ggplot() +
  geom_point(mapping = aes(x = happiness_rank, y = total_alcohol, color = alcohol_cat))

# it seems like it is exacly the opposit

dt_clear %>%
  group_by(alcohol_cat) %>%
  summarise(
    mean_happiness = mean(happiness_score),
    sd_happiness = sd(happiness_score),
    mean_happy_rank = mean(happiness_rank),
    sd_happy_rank = sd(happiness_rank)
  ) %>%
  kable(., digits = 2, align = "l", caption = "Avarages about talalj ki valamit")


dt_clear %>%
  group_by(alcohol_cat) %>%
  summarise(
    mean_happiness = mean(happiness_score),
    sd_happiness = sd(happiness_score),
    mean_happy_rank = mean(happiness_rank),
    sd_happy_rank = sd(happiness_rank)
  ) %>%
  ggplot() +
  geom_bar(aes(x = alcohol_cat, y = mean_happiness), stat = "identity") +
  geom_hline(yintercept = mean(dt_clear$happiness_score), linetype="dotted", color = "red")



```





# Countries where people do not drink alcohol



```{r}
# summary table 
dt_clear %>%
  filter(total_alcohol == 0) %>%
  select(happiness_rank, country, happiness_score, total_alcohol)



# plot
dt_clear %>%
  filter(total_alcohol == 0) %>%
  arrange(happiness_rank) %>%
  ggplot() +
  geom_bar(mapping = aes(x = Region, y = happiness_score, fill = country), stat = "identity", position = "dodge") +
  geom_hline(yintercept = mean(dt_clear$happiness_score), linetype="dotted", color = "red")
  


```



# question two - Do people in happy countries drink different kind of alcohol?


```{r}
# for safety
plot_servings <- dt_clear

# creating happiness categories

plot_servings$happy_cat <- cut(plot_servings$happiness_rank, c(-1, 50, 100, 160), labels = c("happy", "medium happy", "not happy"))



# table

plot_servings %>%
  group_by(happy_cat) %>%
  summarise(
    mn_beer = mean(beer_servings),
    mn_spirit = mean(spirit_servings),
    mn_wine = mean(wine_servings),
    mn_total = mean(total_alcohol)
  ) %>%
  kable(., digits = 2, align = "l", caption = "Valami")


# make the data long format to be able to plot it

plot_servings_plot <- plot_servings %>%
  group_by(happy_cat) %>%
  summarise(
    mn_beer = mean(beer_servings),
    mn_spirit = mean(spirit_servings),
    mn_wine = mean(wine_servings),
    mn_total = mean(total_alcohol)
  ) %>%
  gather(data = ., 
       key = alcohol_type, value = servings,
       'mn_beer':'mn_wine')


# plot

plot_servings_plot %>%
  ggplot() +
  geom_bar(mapping = aes(x = happy_cat, y = servings, fill = alcohol_type), stat = "identity", position = "dodge")

```




# question three - lets see sub categories of happiness: GDP etc.


```{r}
# GDP

dt_clear %>%
  ggplot(., mapping = aes(x = GDP, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick") +
  ylim(0, 15)

# Family
dt_clear %>%
  ggplot(., mapping = aes(x = Family, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick") +
  ylim(0, 15)

# life_expectansy

dt_clear %>%
  ggplot(., mapping = aes(x = life_expectancy, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick") +
  ylim(0, 15)

# Freedom

dt_clear %>%
  ggplot(., mapping = aes(x = Freedom, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick") +
  ylim(0, 15)

# corruption

dt_clear %>%
  ggplot(., mapping = aes(x = corruption, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick") +
  ylim(0, 15)

# generosity

dt_clear %>%
  ggplot(., mapping = aes(x = Generosity, y = total_alcohol)) +
  geom_point(shape = 21, color = "black", fill = "steelblue", alpha = 1/2, size = 2) +
  geom_smooth(color = "firebrick") +
  ylim(0, 15)


```

